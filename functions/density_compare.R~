require(sm)

round100 <- function(x) { 100*ceiling(quantile(x, .99))/100 }

densityCompare <- function(x, y, lab, title) {
  sm.density.compare(x, y, model = "equal", xlab=lab, xlim = c(0,round100(x)))
  title(main = title)
}

lapply(names(results), function(subset) {
  for(i in 1:length(mah_vars)) {
    png(filename = paste(c(subset, mah_vars[i], ".png"), collapse = '_'))
    layout(matrix(seq(1,2,1),1,2))
    lapply(names(results[[subset]][["model_data"]]), function(x) {
      k <- results[[subset]][["model_data"]][[x]]
      print(densityCompare(k[,mah_vars[i]], k[,'treatment'], mah_vars[i], x)) })
    dev.off()
  }
})